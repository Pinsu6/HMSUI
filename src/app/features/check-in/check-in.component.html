<div class="check-in">
  <!-- Page Header -->
  <div class="page-header">
    <div>
      <h1 class="page-title">Guest Check-In</h1>
      <p class="page-subtitle">Complete the check-in process for a new guest</p>
    </div>
  </div>

  <!-- Progress Steps -->
  <div class="progress-container">
    <div class="progress-steps">
      <div class="step" [class.active]="currentStep === 1" [class.completed]="currentStep > 1" (click)="goToStep(1)">
        <div class="step-number">
          <span *ngIf="currentStep <= 1">1</span>
          <span *ngIf="currentStep > 1">‚úì</span>
        </div>
        <span class="step-label">Select Room</span>
      </div>
      <div class="step-line" [class.active]="currentStep > 1"></div>
      <div class="step" [class.active]="currentStep === 2" [class.completed]="currentStep > 2" (click)="goToStep(2)">
        <div class="step-number">
          <span *ngIf="currentStep <= 2">2</span>
          <span *ngIf="currentStep > 2">‚úì</span>
        </div>
        <span class="step-label">Guest Details</span>
      </div>
      <div class="step-line" [class.active]="currentStep > 2"></div>
      <div class="step" [class.active]="currentStep === 3" [class.completed]="currentStep > 3" (click)="goToStep(3)">
        <div class="step-number">
          <span *ngIf="currentStep <= 3">3</span>
          <span *ngIf="currentStep > 3">‚úì</span>
        </div>
        <span class="step-label">Booking Details</span>
      </div>
      <div class="step-line" [class.active]="currentStep > 3"></div>
      <div class="step" [class.active]="currentStep === 4" (click)="goToStep(4)">
        <div class="step-number">4</div>
        <span class="step-label">Confirm & Pay</span>
      </div>
    </div>
  </div>

  <div class="check-in-content">
    <!-- Step 1: Select Room -->
    <div class="step-content" *ngIf="currentStep === 1">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">üõèÔ∏è Select Available Room</h3>
          <span class="available-count">{{ availableRooms.length }} rooms available</span>
        </div>
        <div class="rooms-selection-header">
          <div class="room-type-filters">
            <button *ngFor="let type of uniqueRoomTypes" class="filter-chip" [class.active]="selectedRoomType === type"
              (click)="selectedRoomType = type; selectedRoom = null">
              {{ type }}
            </button>
          </div>
        </div>

        <div class="rooms-selection">
          <div *ngFor="let room of filteredRooms" class="room-option"
            [class.selected]="selectedRoom?.roomId === room.roomId" (click)="selectRoom(room)">
            <div class="room-option-header">
              <span class="room-number">{{ room.number }}</span>
              <span class="room-type-badge">{{ getRoomType(room) }}</span>
            </div>
            <div class="room-option-body">
              <div class="room-rate">
                <span class="rate-value">‚Çπ{{ getRoomBaseRate(room) | number }}</span>
                <span class="rate-period">/night</span>
              </div>
              <div class="room-capacity">
                <span>üë• Max {{ getRoomMaxGuests(room) }} guests</span>
              </div>
            </div>
            <div class="room-option-footer">
              <span class="select-indicator">
                {{ selectedRoom?.roomId === room.roomId ? '‚úì Selected' : 'Click to select' }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Step 2: Guest Details -->
    <div class="step-content" *ngIf="currentStep === 2">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">üë§ Guest Information</h3>
        </div>
        <div class="form-content">
          <div class="form-section">
            <h4 class="section-title">Personal Details</h4>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Full Name *</label>
                <input type="text" class="form-input" placeholder="Enter guest's full name"
                  [(ngModel)]="guestDetails.fullName">
              </div>
              <div class="form-group">
                <label class="form-label">Mobile Number *</label>
                <input type="tel" class="form-input" placeholder="+91 XXXXX XXXXX" [(ngModel)]="guestDetails.mobile">
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">Email Address</label>
              <input type="email" class="form-input" placeholder="email@example.com" [(ngModel)]="guestDetails.email">
            </div>
          </div>

          <div class="form-section">
            <h4 class="section-title">ID Verification (KYC)</h4>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">ID Type *</label>
                <select class="form-select" [(ngModel)]="guestDetails.idType">
                  <option *ngFor="let type of idTypes" [value]="type">{{ type }}</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">ID Number *</label>
                <input type="text" class="form-input" placeholder="Enter ID number" [(ngModel)]="guestDetails.idNumber">
              </div>
            </div>
          </div>

          <div class="form-section">
            <h4 class="section-title">Address</h4>
            <div class="form-group">
              <label class="form-label">Street Address</label>
              <input type="text" class="form-input" placeholder="Enter street address"
                [(ngModel)]="guestDetails.address">
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">City</label>
                <input type="text" class="form-input" placeholder="City" [(ngModel)]="guestDetails.city">
              </div>
              <div class="form-group">
                <label class="form-label">Country</label>
                <input type="text" class="form-input" placeholder="Country" [(ngModel)]="guestDetails.country">
              </div>
            </div>
          </div>

          <div class="form-section">
            <h4 class="section-title">Additional Information</h4>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Purpose of Visit</label>
                <select class="form-select" [(ngModel)]="guestDetails.purpose">
                  <option *ngFor="let purpose of purposes" [value]="purpose">{{ purpose }}</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">Special Requests</label>
              <textarea class="form-textarea" placeholder="Any special requirements..."
                [(ngModel)]="guestDetails.specialRequests"></textarea>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Step 3: Booking Details -->
    <div class="step-content" *ngIf="currentStep === 3">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">üìÖ Stay Details</h3>
        </div>
        <div class="form-content">
          <div class="form-section">
            <h4 class="section-title">Check-In / Check-Out</h4>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Check-In Date *</label>
                <input type="date" class="form-input" [(ngModel)]="bookingDetails.checkInDate">
              </div>
              <div class="form-group">
                <label class="form-label">Check-In Time</label>
                <input type="time" class="form-input" [(ngModel)]="bookingDetails.checkInTime">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Check-Out Date *</label>
                <input type="date" class="form-input" [(ngModel)]="bookingDetails.checkOutDate">
              </div>
              <div class="form-group">
                <label class="form-label">Check-Out Time</label>
                <input type="time" class="form-input" [(ngModel)]="bookingDetails.checkOutTime">
              </div>
            </div>
            <div class="nights-display" *ngIf="totalNights > 0">
              <span class="nights-icon">üåô</span>
              <span class="nights-count">{{ totalNights }} Night{{ totalNights > 1 ? 's' : '' }}</span>
            </div>
          </div>

          <div class="form-section">
            <h4 class="section-title">Guests</h4>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Adults</label>
                <div class="number-input">
                  <button type="button" (click)="decrementAdults()">‚àí</button>
                  <input type="number" class="form-input" [(ngModel)]="bookingDetails.adults" min="1">
                  <button type="button" (click)="bookingDetails.adults = bookingDetails.adults + 1">+</button>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">Children</label>
                <div class="number-input">
                  <button type="button" (click)="decrementChildren()">‚àí</button>
                  <input type="number" class="form-input" [(ngModel)]="bookingDetails.children" min="0">
                  <button type="button" (click)="bookingDetails.children = bookingDetails.children + 1">+</button>
                </div>
              </div>
            </div>
          </div>

          <div class="form-section">
            <h4 class="section-title">Additional Services</h4>
            <div class="checkbox-group">
              <label class="checkbox-label">
                <input type="checkbox" [(ngModel)]="bookingDetails.extraBed">
                <span class="checkmark"></span>
                <span class="checkbox-text">
                  Extra Bed
                  <span class="checkbox-price">‚Çπ500/night</span>
                </span>
              </label>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Step 4: Confirm & Pay -->
    <div class="step-content" *ngIf="currentStep === 4">
      <div class="confirmation-grid">
        <!-- Booking Summary -->
        <div class="card summary-card">
          <div class="card-header">
            <h3 class="card-title">üìã Booking Summary</h3>
          </div>
          <div class="summary-content">
            <div class="summary-section">
              <h4>Room Details</h4>
              <div class="summary-row">
                <span>Room Number</span>
                <span class="summary-value highlight">{{ selectedRoom?.number }}</span>
              </div>
              <div class="summary-row">
                <span>Room Type</span>
                <span class="summary-value">{{ getRoomType(selectedRoom!) }}</span>
              </div>
              <div class="summary-row">
                <span>Rate per Night</span>
                <span class="summary-value">‚Çπ{{ getRoomBaseRate(selectedRoom!) | number }}</span>
              </div>
            </div>

            <div class="summary-section">
              <h4>Guest Details</h4>
              <div class="summary-row">
                <span>Guest Name</span>
                <span class="summary-value">{{ guestDetails.fullName }}</span>
              </div>
              <div class="summary-row">
                <span>Mobile</span>
                <span class="summary-value">{{ guestDetails.mobile }}</span>
              </div>
              <div class="summary-row">
                <span>{{ guestDetails.idType }}</span>
                <span class="summary-value">{{ guestDetails.idNumber }}</span>
              </div>
            </div>

            <div class="summary-section">
              <h4>Stay Information</h4>
              <div class="summary-row">
                <span>Check-In</span>
                <span class="summary-value">{{ bookingDetails.checkInDate }} {{ bookingDetails.checkInTime }}</span>
              </div>
              <div class="summary-row">
                <span>Check-Out</span>
                <span class="summary-value">{{ bookingDetails.checkOutDate }} {{ bookingDetails.checkOutTime }}</span>
              </div>
              <div class="summary-row">
                <span>Duration</span>
                <span class="summary-value">{{ totalNights }} Night(s)</span>
              </div>
              <div class="summary-row">
                <span>Guests</span>
                <span class="summary-value">{{ bookingDetails.adults }} Adult(s), {{ bookingDetails.children }}
                  Child(ren)</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Payment Section -->
        <div class="card payment-card">
          <div class="card-header">
            <h3 class="card-title">üí≥ Payment Details</h3>
          </div>
          <div class="payment-content">
            <!-- Charges Breakdown -->
            <div class="charges-breakdown">
              <div class="charge-row">
                <span>Room Charges ({{ totalNights }} nights √ó ‚Çπ{{ getRoomBaseRate(selectedRoom!) | number }})</span>
                <span>‚Çπ{{ roomCharges | number }}</span>
              </div>
              <div class="charge-row" *ngIf="bookingDetails.extraBed">
                <span>Extra Bed ({{ totalNights }} nights √ó ‚Çπ500)</span>
                <span>‚Çπ{{ extraBedCharges | number }}</span>
              </div>
              <div class="charge-row subtotal">
                <span>Subtotal</span>
                <span>‚Çπ{{ subtotal | number }}</span>
              </div>
              <div class="charge-row">
                <span>GST (18%)</span>
                <span>‚Çπ{{ taxAmount | number }}</span>
              </div>
              <div class="charge-row total">
                <span>Total Amount</span>
                <span>‚Çπ{{ totalAmount | number }}</span>
              </div>
            </div>

            <!-- Advance Payment -->
            <div class="form-section">
              <h4 class="section-title">Advance Payment</h4>
              <div class="form-group">
                <label class="form-label">Payment Amount</label>
                <input type="number" class="form-input" placeholder="Enter advance amount"
                  [(ngModel)]="paymentDetails.advancePayment">
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label">Payment Mode</label>
                  <select class="form-select" [(ngModel)]="paymentDetails.paymentMode">
                    <option value="Cash">Cash</option>
                    <option value="Card">Card</option>
                    <option value="UPI">UPI</option>
                    <option value="Bank Transfer">Bank Transfer</option>
                  </select>
                </div>
                <div class="form-group" *ngIf="paymentDetails.paymentMode !== 'Cash'">
                  <label class="form-label">Transaction ID</label>
                  <input type="text" class="form-input" placeholder="Enter transaction ID"
                    [(ngModel)]="paymentDetails.transactionId">
                </div>
              </div>
            </div>

            <!-- Balance -->
            <div class="balance-display" [class.paid]="balanceAmount <= 0">
              <div class="balance-label">Balance Due</div>
              <div class="balance-amount">‚Çπ{{ balanceAmount | number }}</div>
            </div>

            <!-- WiFi Notice -->
            <div class="wifi-notice">
              <span class="wifi-icon">üì∂</span>
              <p>WiFi access will be automatically activated for the guest upon check-in confirmation.</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Navigation Buttons -->
    <div class="step-navigation">
      <button class="btn btn-secondary" *ngIf="currentStep > 1" (click)="prevStep()">
        ‚Üê Previous
      </button>
      <div class="spacer"></div>
      <button class="btn btn-primary" *ngIf="currentStep < totalSteps" [disabled]="!isStepValid(currentStep)"
        (click)="nextStep()">
        Next Step ‚Üí
      </button>
      <button class="btn btn-success btn-lg" *ngIf="currentStep === totalSteps" (click)="confirmCheckIn()">
        ‚úì Confirm Check-In
      </button>
    </div>
  </div>
</div>